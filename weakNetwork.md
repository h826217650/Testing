
# 1 弱网模拟
用户在地铁里，巴士上，甚至是电梯，车库等场景使用APP，我们就需要针对这些场景的弱网环境下，验证出现丢包、延时软件的处理机制，避免因用户体验不友好造成用户的流失。
## <软件模拟>
### * charlottes
*  proxy -> throttle settings -> enable throttling
![](/Users/huxiaoyan/Desktop/throttlting设置.png)


* 附不同网络下的带宽参数
![](/Users/huxiaoyan/Desktop/不同网络环境下带宽说明.png)

### * fiddler
使用于window系统
![](/Users/huxiaoyan/Desktop/fiddle1)
![](/Users/huxiaoyan/Desktop/fiddler2)
![](/Users/huxiaoyan/Desktop/fiddler3)
### * chrome web端
工具->开发者选项->network

## <硬件模拟>
### * Facebook之ATC
[ATC配置](http://blog.csdn.net/w263044840/article/details/46469285)
### * 树莓派
[树莓派设置](http://app.myalert.info/2015/03/28/59-use-raspberrypi-to-build-an-augmented-traffic-control-system.html)
## <iOS手机模拟>
iOS平台，通过自带的开发者选项 》Network Link Conditioner, 即可简单的模拟各种速度的网络情况

# 2 弱网testcase
## 2.1 功能测试
在弱网环境下，把所有功能走一遍是否可以走通。弱网的高延迟和高丢包，会造成功能阻塞。（就像公交车虽慢 却可以到达目的地）
## 2.2 性能测试
* 响应时间指标
   1. 网页的三秒定律
   2. android移动端的五秒定律(5s ANR)  
   
* 对应的场景
  热启动+页面切换+前后台切换
* 需观察数据
   整体时间 + response body  
   通过上面俩数据判断是服务器的锅还是移动端的。如果time小，且body小 则肯定是客户端的锅了
   
## 2.3 异常测试
* 考虑弱网情况下带来的不稳定，等待超时 ANR了，或者直接异常闪退了。这些的处理，一定要做的优雅，不能粗鲁。由自己控制总好过系统控制，会让用户看出产品的用心。
* 从无网到有网：是否会有请求堆积（支付时，无网or弱网时是否会发送多个支付请求，导致多笔账单的支出）
 
## 2.4 场景测试

![](/Users/huxiaoyan/Desktop/app网络测试点)
现象：用户登录应用时下载初始化数据，下载过程中因网速太慢点击取消并重新登录，数据初始化完成后出现重复，造成数据不一致。

原因：数据下载过程中、下载失败后，未进行数据回滚，中止后重新下载，出现数据重复

解决方案 ：通过事务处理数据下载逻辑，下载失败后，应用本地数据库进行数据回滚。

2、现象：用户点击数据上传，数据上传过程中网络弱且不稳定，基于联网状态自动触发数据上传，导致出现数据重复写入，形成脏数据

原因：数据上传过程中， 由于失败重传机制，会出现连续两次写操作，并且未做唯一识别处理

解决方案 ：根据数据特性，对可能造成脏数据的地方，通过关键字段，例如创建时间，key-value值等生成hash键，标记记录唯一性，即数据写入时，检查hash键是否存在，如果已经存在，当前重复数据丢弃。

3、现象：在弱网环境下，用户输入用户名和密码点击登录，应用链接超时返回用户名和密码错误提示。

原因：在弱网环境下的连接超时后，按照强网业务逻辑处理，导致返回超时异常。

解决方案 ： 弱网连接超时后，检查应用本地数据库是否有用户登录信息，若存在，获取应用本地用户信息进行登录。

4-ss-cloud-wifi

4、现象：在弱网环境下，用户输入用户名和密码后点击登录，登录过程中应用崩溃并且闪退。

原因：弱网环境下数据下载超时，加载数据严重依赖于后来的异步加载。数据还没来得及返回，应用跳转到下个activity，导致崩溃。

解决方案 ：健壮数据加载流程，通过标记后台数据下载状态加载界面，依赖数据下载完成后，再进行页面跳转。

5、现象：弱网络环境下，用户请求页面响应时间较长，等待的过程中，页面上的部分控件仍然可以操作，当用户点击控件时，出现应用闪退现象；

原因：没有对数据加载流程进行判断，直接暴露控件可控，当出现依赖数据的控件操作时，没有在数据返回前做兼容处理。

解决方案 ：在数据加载过程中，设置页面对外暴露的控件为“不可操作”，当数据加载完再释放。

6、现象：在弱网环境下，用户第一次输入搜索关键字没有得到响应后，再次输入全新关键字并发送请求，等待搜索结果返回后，当前结果页被之前的关键字搜索结果刷新覆盖

原因：中间的请求返回较慢，显示最终的结果后，之前请求返回的数据应不做处理。

解决方案 ：对异步请求未完成的任务进行cancel.